<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vilamoura Guide Pro</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCqRtZgE7hw-znacoAqXuXZ4SEGVuXWudo&libraries=places"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100vh; width: 100%; overflow: hidden; background: #f4f7f9; font-family: 'Segoe UI', sans-serif; }
        #root { height: 100%; width: 100%; }
        
        /* Splash Screen Atualizado */
        .splash-screen { 
            position: fixed; top:0; left:0; width:100%; height:100%; 
            background: #ffffff; /* Fundo branco para destacar o logo */
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; z-index: 1000; text-align: center; 
        }
        .splash-logo-img { 
            width: 80%; 
            max-width: 300px; 
            height: auto; 
            margin-bottom: 30px;
        }

        .lang-bar { background: #003366; display: flex; justify-content: center; gap: 5px; padding: 8px; border-bottom: 2px solid #c5a059; height: 45px; box-sizing: border-box; }
        .lang-btn { background: rgba(255,255,255,0.1); border: 1px solid #fff; color: #fff; padding: 4px 8px; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: bold; }
        .lang-btn.active { background: #c5a059; border-color: #c5a059; }

        .app-content { height: calc(100vh - 45px); position: relative; width: 100%; }

        .menu-view { height: 100%; overflow-y: auto; padding-bottom: 80px; box-sizing: border-box; }
        .search-area { padding: 15px; position: sticky; top: 0; background: #f4f7f9; z-index: 10; }
        .search-box { position: relative; }
        .search-box input { width: 100%; padding: 12px 40px; border-radius: 25px; border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.1); box-sizing: border-box; }
        .search-box i { position: absolute; left: 15px; top: 14px; color: #888; }

        .grid-cats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 15px; }
        .cat-card { background: #fff; border-radius: 15px; text-align: center; padding: 20px 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid #eee; }
        
        .footer-nav { position: absolute; bottom: 0; width: 100%; padding: 15px; background: white; border-top: 1px solid #eee; box-sizing: border-box; text-align: center; }
        .btn-explore { width: 100%; max-width: 300px; padding: 14px; border-radius: 30px; background: #27ae60; color: white; border: none; font-weight: bold; font-size: 16px; cursor: pointer; }

        .map-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 20; background: white; }
        .btn-back-map { position: absolute; top: 15px; left: 15px; z-index: 30; padding: 10px 20px; border-radius: 25px; background: #003366; color: white; border: 2px solid white; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        #map-canvas { width: 100%; height: 100%; }

        .item-row { display: flex; gap: 12px; background: #fff; padding: 12px; border-radius: 12px; margin: 0 15px 10px 15px; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .info-buttons { display: flex; flex-direction: column; gap: 5px; margin-top: 10px; }
        .btn-info { display: block; text-align: center; padding: 8px; border-radius: 4px; text-decoration: none; color: white; font-size: 12px; font-weight: bold; border: none; cursor: pointer; }
        .bg-blue { background: #003366; }
        .bg-green { background: #27ae60; }
        .bg-gold { background: #c5a059; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const mapStyle = [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }] }];

        const i18n = {
          pt: { enter: "ENTRAR", search: "Procurar em Vilamoura...", back: "VOLTAR", walk: "ROTA A P√â", explore: "üìç EXPLORAR TUDO", cats: { hoteis: "Hot√©is", comer: "Comer", bares: "Bares", lazer: "Lazer", golf: "Golf", lojas: "Lojas", imobiliarias: "Im√≥veis", util: "√ötil" } },
          en: { enter: "ENTER", search: "Search Vilamoura...", back: "BACK", walk: "WALK ROUTE", explore: "üìç EXPLORE ALL", cats: { hoteis: "Hotels", comer: "Eat", bares: "Bars", lazer: "Leisure", golf: "Golf", lojas: "Shops", imobiliarias: "Property", util: "Useful" } },
          fr: { enter: "ENTRER", search: "Chercher...", back: "RETOUR", walk: "MARCHER", explore: "üìç TOUT VOIR", cats: { hoteis: "H√¥tels", comer: "Manger", bares: "Bars", lazer: "Loisirs", golf: "Golf", lojas: "Boutiques", imobiliarias: "Immo", util: "Utile" } },
          de: { enter: "EINTRETEN", search: "Suche...", back: "ZUR√úCK", walk: "GEHEN", explore: "üìç ALLES SEHEN", cats: { hoteis: "Hotels", comer: "Essen", bares: "Bars", lazer: "Freizeit", golf: "Golf", lojas: "L√§den", imobiliarias: "Immo", util: "N√ºtzlich" } },
          es: { enter: "ENTRAR", search: "Buscar...", back: "VOLVER", walk: "CAMINAR", explore: "üìç EXPLORAR TODO", cats: { hoteis: "Hoteles", comer: "Comer", bares: "Bares", lazer: "Ocio", golf: "Golf", lojas: "Tiendas", imobiliarias: "Inmuebles", util: "√ötil" } }
        };

        const LOCAIS = [
            { id: "tivoli", nome: "Tivoli Marina", cat: "hoteis", lat: 37.07433, lng: -8.12017, icon: "üè®", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbuotHReCbbgAZXVruQoDzpVQWaZTeqsqIHnANJDswD4BO8OF-oV0nfHsMd-G9zcEpAnpa2FTJtw94Fv0RiGgucHGOtnWz0UdQhce_R5A3inLhytkobCXvrP3bYc8T95Lv03hLt98GIbujpIZeCkiyHt6UZamuoo3MSLhhSBf9nawoKk-12X-8-i4C7GH_/w453-h301/Tivoli_Marina_Vilamoura_.jpg", web: "https://www.tivolihotels.com", tel: "+351289303300", info: { pt: "Luxo sobre a Marina", en: "Luxury over the Marina", fr: "Luxe sur la Marina", de: "Luxus am Hafen", es: "Lujo en la Marina" } },
            { id: "hole19", nome: "19th Hole", cat: "bares", lat: 37.0755, lng: -8.1192, icon: "üç∫", img: "https://media-cdn.tripadvisor.com/media/photo-s/02/db/0b/a4/19th-hole.jpg", web: "https://www.facebook.com/19thHoleVilamoura", tel: "+351289381730", info: { pt: "Melhores Cocktails", en: "Best Cocktails", fr: "Meilleurs Cocktails", de: "Beste Cocktails", es: "Mejores C√≥cteles" } },
            { id: "ampalius", nome: "Vila Gal√© Ampalius", cat: "hoteis", lat: 37.0773, lng: -8.1179, icon: "üè®", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhGVY9LR4Vy8uzfLr-M1OUhJ9VUCAYWg0OAbCOvXzoHhKTxr_3pvfa9I7eCk0tF6P8cHL35VyfCzFb7ZoVcwl-jCBhAdfa_zUuqgTXqnqUPBnZByM_x1lAO32VhpEJQiWGmcE9SbTAd-3AyGxWvJfXoajE0bw7W30cJHf95nymYA9ll8fQrUXD8usF5Fsms/w462-h307/Vila%20Gale%20Ampalius.jfif", web: "https://www.vilagale.com", tel: "+351289303970", info: { pt: "Frente √† praia", en: "Beachfront", fr: "Face √† la plage", de: "Direkt am Strand", es: "Frente a la playa" } },
            { id: "colombo", nome: "Colombo", cat: "comer", lat: 37.0757, lng: -8.1150, icon: "üç¥", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh8BrDSbJXJaPu4G5ahigmv5fnnO71cxKiQfxiJmAZe-jgUcX3cQQG6XXzP0sCgRO_W4jFbfBDytY2oRqaBSWmV8nOkSkapWCvRtFgwPTTGK7PoDNVs_mTeDW11iP_QIo2iwxRtvhkLbjwIRjuUI340anqpR5UchWkRLqQCvsBo0X7gPv97dDZ7xifW0uWY/s1600/20220930_194648.jpg", web: "https://www.facebook.com/restaurante.colombo.vilamoura", tel: "+351289314111", info: { pt: "Cozinha tradicional", en: "Traditional cuisine", fr: "Cuisine traditionnelle", de: "Traditionelle K√ºche", es: "Cocina tradicional" } },
            { id: "oldcourse", nome: "Old Course", cat: "golf", lat: 37.1021, lng: -8.1155, icon: "üèåÔ∏è", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi9TeufNw3s8cvFQCBMyEjurQCvim1PTN9Pgyp-wEehCZJXBgRNmvWMjjFIpwhWnbQu_jZ-s-7D8ufYQQTmccDbObpt4yIia1-xm3k0d1NiDCUORo_QIZkmFBmR4Z6dfxo7vWdHh538CPfO8Ar5SOfadBxHptQ0RDSUVp-hPaKJaSecDb5Q2WhPDzR8yOji/s320/old-course-with-logo.jpg", web: "https://www.dompedrogolf.com", tel: "+351289310333", info: { pt: "Campo Cl√°ssico", en: "Classic Course", fr: "Parcours classique", de: "Klassischer Platz", es: "Campo Cl√°sico" } },
            { id: "gnr", nome: "GNR Vilamoura", cat: "util", lat: 37.08552, lng: -8.11651, icon: "üöì", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQgNFxLWvwZnkV9I4cIlNTLi93LFVaWr3y2oVgyPoGt87EBiETjT2ZT2Jw-XxMOEco59kpDHgwKAympVvrrtSXTvk1pTEh13ZH_OOl3nbDQLtryq1QepMEPz_sve47DwMPwbgINSkmnIajW9R2VQT9lX7Wu4_VeEY-NdO2_Ib_3uuAwjZj6EExkUsETE3f/s320/GNR.jpg", web: "#", tel: "+351289300430", info: { pt: "Seguran√ßa 24h", en: "24h Security", fr: "S√©curit√© 24h", de: "24h Sicherheit", es: "Seguran√ßa 24h" } }
        ];

        const CATEGORIAS = [
          { id: 'hoteis', icon: 'fa-hotel' }, { id: 'comer', icon: 'fa-utensils' },
          { id: 'bares', icon: 'fa-glass-cheers' }, { id: 'lazer', icon: 'fa-camera-retro' },
          { id: 'golf', icon: 'fa-golf-ball-tee' }, { id: 'lojas', icon: 'fa-bag-shopping' },
          { id: 'imobiliarias', icon: 'fa-house-chimney' }, { id: 'util', icon: 'fa-shield-halved' }
        ];

        function App() {
          const [view, setView] = useState('splash');
          const [lang, setLang] = useState('pt');
          const [subView, setSubView] = useState('grid');
          const [catAtiva, setCatAtiva] = useState(null);
          const [query, setQuery] = useState('');
          
          const mapRef = useRef(null);
          const googleMap = useRef(null);
          const markers = useRef([]);
          const directionsRenderer = useRef(null);

          const t = i18n[lang];

          useEffect(() => {
            if (view === 'menu' && !googleMap.current && mapRef.current) {
                googleMap.current = new google.maps.Map(mapRef.current, {
                    center: { lat: 37.076, lng: -8.118 },
                    zoom: 15,
                    disableDefaultUI: true,
                    styles: mapStyle
                });
                directionsRenderer.current = new google.maps.DirectionsRenderer({
                    map: googleMap.current,
                    suppressMarkers: false,
                    polylineOptions: { strokeColor: "#003366", strokeWeight: 5 }
                });
            }
          }, [view]);

          const clearMarkers = () => {
            markers.current.forEach(m => m.setMap(null));
            markers.current = [];
            if(directionsRenderer.current) directionsRenderer.current.setDirections({routes: []});
          };

          const handleRoute = (lat, lng) => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    const start = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                    const end = { lat, lng };
                    const service = new google.maps.DirectionsService();
                    service.route({
                        origin: start,
                        destination: end,
                        travelMode: google.maps.TravelMode.WALKING
                    }, (result, status) => {
                        if (status === 'OK') directionsRenderer.current.setDirections(result);
                    });
                });
            }
          };

          const openMap = (items) => {
            setSubView('mapa');
            clearMarkers();
            const list = Array.isArray(items) ? items : [items];
            
            list.forEach(loc => {
                const marker = new google.maps.Marker({
                    position: { lat: loc.lat, lng: loc.lng },
                    map: googleMap.current,
                    label: { text: loc.icon, color: 'white', fontSize: '14px' },
                    icon: { path: google.maps.SymbolPath.CIRCLE, scale: 16, fillColor: '#003366', fillOpacity: 1, strokeWeight: 2, strokeColor: 'white' }
                });

                marker.addListener('click', () => {
                    const contentDiv = document.createElement('div');
                    contentDiv.style.width = '180px';
                    contentDiv.innerHTML = `
                        <img src="${loc.img}" style="width:100%;border-radius:5px">
                        <h4 style="margin:5px 0">${loc.nome}</h4>
                        <p style="font-size:11px">${loc.info[lang]}</p>
                        <div class="info-buttons">
                            ${loc.web !== '#' ? `<a href="${loc.web}" target="_blank" class="btn-info bg-blue">Website</a>` : ''}
                            <a href="tel:${loc.tel}" class="btn-info bg-green">Ligar</a>
                            <button class="btn-info bg-gold" id="btn-route-action">${t.walk}</button>
                        </div>
                    `;
                    
                    const infoWindow = new google.maps.InfoWindow({ content: contentDiv });
                    infoWindow.open(googleMap.current, marker);

                    google.maps.event.addListenerOnce(infoWindow, 'domready', () => {
                        document.getElementById('btn-route-action').onclick = () => {
                            handleRoute(loc.lat, loc.lng);
                            infoWindow.close();
                        };
                    });
                });
                markers.current.push(marker);
            });

            if(!Array.isArray(items)) {
                googleMap.current.setCenter({ lat: items.lat, lng: items.lng });
                googleMap.current.setZoom(17);
            } else {
                googleMap.current.setCenter({ lat: 37.076, lng: -8.118 });
                googleMap.current.setZoom(15);
            }
            setTimeout(() => google.maps.event.trigger(googleMap.current, 'resize'), 300);
          };

          const filtered = LOCAIS.filter(l => l.nome.toLowerCase().includes(query.toLowerCase()));

          if (view === 'splash') {
              return (
                  <div className="splash-screen">
                      {/* LINK DIRETO DA IMAGEM APLICADO AQUI */}
                      <img src="https://i.postimg.cc/mD8Tf8Xj/Vilamoura-Guide-Logo.gif" className="splash-logo-img" alt="Vilamoura Guide Pro Logo" />
                      <button className="btn-explore" style={{width:'200px'}} onClick={() => setView('menu')}>
                        {i18n[lang].enter}
                      </button>
                  </div>
              );
          }

          return (
            <div style={{height: '100%'}}>
              <div className="lang-bar">
                {['pt','en','fr','de','es'].map(l => (
                  <button key={l} className={`lang-btn ${lang === l ? 'active' : ''}`} onClick={() => setLang(l)}>{l.toUpperCase()}</button>
                ))}
              </div>

              <div className="app-content">
                <div className="menu-view" style={{ display: subView !== 'mapa' ? 'block' : 'none' }}>
                    <div className="search-area">
                        <div className="search-box">
                            <i className="fas fa-search"></i>
                            <input type="text" placeholder={t.search} value={query} onChange={(e) => {setQuery(e.target.value); setSubView('grid');}} />
                        </div>
                    </div>

                    {query.length > 0 ? (
                        <div>
                            {filtered.map(l => (
                                <div key={l.id} className="item-row" onClick={() => openMap(l)}>
                                    <img src={l.img} style={{width:'50px', height:'50px', objectFit:'cover', borderRadius:'8px'}} />
                                    <div><div style={{fontWeight:'bold', color:'#003366'}}>{l.nome}</div><div style={{fontSize: '12px'}}>{l.info[lang]}</div></div>
                                </div>
                            ))}
                        </div>
                    ) : subView === 'grid' ? (
                        <div className="grid-cats">
                            {CATEGORIAS.map(c => (
                                <div key={c.id} className="cat-card" onClick={() => { setCatAtiva(c.id); setSubView('lista'); }}>
                                    <i className={`fas ${c.icon}`} style={{fontSize:'24px', color:'#003366'}}></i>
                                    <div style={{marginTop:'8px', fontSize:'13px', fontWeight:'bold'}}>{t.cats[c.id]}</div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div>
                            <button onClick={() => setSubView('grid')} style={{margin:'0 15px 15px', background:'none', border:'none', color:'#003366', fontWeight:'bold'}}>‚Üê {t.back}</button>
                            {LOCAIS.filter(l => l.cat === catAtiva).map(l => (
                                <div key={l.id} className="item-row" onClick={() => openMap(l)}>
                                    <img src={l.img} style={{width:'50px', height:'50px', objectFit:'cover', borderRadius:'8px'}} />
                                    <div><div style={{fontWeight:'bold', color:'#003366'}}>{l.nome}</div><div style={{fontSize: '12px'}}>{l.info[lang]}</div></div>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    <div className="footer-nav">
                        <button className="btn-explore" onClick={() => openMap(LOCAIS)}>{t.explore}</button>
                    </div>
                </div>

                <div className="map-view" style={{ visibility: subView === 'mapa' ? 'visible' : 'hidden' }}>
                    <button className="btn-back-map" onClick={() => setSubView('grid')}>MENU</button>
                    <div ref={mapRef} id="map-canvas"></div>
                </div>
              </div>
            </div>
          );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
